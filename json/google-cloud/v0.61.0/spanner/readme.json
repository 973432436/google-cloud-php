{"id":"spanner\/readme","type":"guide","title":"Google Cloud PHP Spanner","name":"Google Cloud PHP Spanner","description":"<body>\n<blockquote>\n<p>Idiomatic PHP client for <a href=\"https:\/\/cloud.google.com\/spanner\/\">Cloud Spanner<\/a>.<\/p>\n<\/blockquote>\n<p><a href=\"https:\/\/packagist.org\/packages\/google\/cloud-spanner\"><img src=\"https:\/\/poser.pugx.org\/google\/cloud-spanner\/v\/stable\" alt=\"Latest Stable Version\"><\/a> <a href=\"https:\/\/packagist.org\/packages\/google\/cloud-spanner\"><img src=\"https:\/\/img.shields.io\/packagist\/dm\/google\/cloud-spanner.svg\" alt=\"Packagist\"><\/a><\/p>\n<ul>\n<li><a href=\"http:\/\/googlecloudplatform.github.io\/google-cloud-php\">Homepage<\/a><\/li>\n<li><a href=\"http:\/\/googlecloudplatform.github.io\/google-cloud-php\/#\/docs\/cloud-spanner\/latest\/spanner\/spannerclient\">API documentation<\/a><\/li>\n<\/ul>\n<p><strong>NOTE:<\/strong> This repository is part of <a href=\"https:\/\/github.com\/googlecloudplatform\/google-cloud-php\">Google Cloud PHP<\/a>. Any\nsupport requests, bug reports, or development contributions should be directed to\nthat project.<\/p>\n<p>If it is not already installed, you will also require the gRPC extension. For installation instructions, <a href=\"https:\/\/cloud.google.com\/php\/grpc\">see here<\/a>.<\/p>\n<p>NOTE: In addition to the gRPC extension, we recommend installing the protobuf extension for improved performance. For installation instructions, <a href=\"https:\/\/cloud.google.com\/php\/grpc#install_the_protobuf_runtime_library\">see here<\/a>.<\/p>\n<h2>Installation<\/h2>\n<pre><code>$ composer require google\/cloud-spanner<\/code><\/pre>\n<h2>Session warmup<\/h2>\n<p>To issue a query against the Spanner service, the client library needs to request a session id from the server under the cover. This API call will add significant latency to your program. The Spanner client library provides a handy way to alleviate this problem by having a cached session pool.<\/p>\n<p>For more details, see: <a href=\"https:\/\/github.com\/GoogleCloudPlatform\/google-cloud-php\/blob\/master\/Spanner\/src\/Session\/CacheSessionPool.php#L30\">https:\/\/github.com\/GoogleCloudPlatform\/google-cloud-php\/blob\/master\/Spanner\/src\/Session\/CacheSessionPool.php#L30<\/a><\/p>\n<p>The following example shows how to use the <code>CacheSessionPool<\/code> with <code>SysVCacheItemPool<\/code> as well as how to configure a proper cache for authentication:<\/p>\n<pre><code class=\"language-php\">require __DIR__ . '\/vendor\/autoload.php';\n\nuse Google\\Cloud\\Spanner\\SpannerClient;\nuse Google\\Cloud\\Spanner\\Session\\CacheSessionPool;\nuse Google\\Auth\\Cache\\SysVCacheItemPool;\n\n$authCache = new SysVCacheItemPool();\n$sessionCache = new SysVCacheItemPool([\n    \/\/ Use a different project identifier for ftok than the default\n    'proj' =&gt; 'B'\n]);\n\n$spanner = new SpannerClient([\n    'authCache' =&gt; $authCache\n]);\n\n$sessionPool = new CacheSessionPool(\n    $sessionCache,\n    [\n        'minSession' =&gt; 10,\n        'maxSession' =&gt; 10  \/\/ Here it will create 10 sessions under the cover.\n    ]\n);\n\n$database = $client-&gt;connect(\n    'my-instance',\n    'my-db',\n    [\n        'sessionPool' =&gt; $sessionPool\n    ]\n);\n\/\/ `warmup` will actually create the sessions for the first time.\n$sessionPool-&gt;warmup();\n<\/code><\/pre>\n<p>By using a cache implementation like <code>SysVCacheItemPool<\/code>, you can share the cached sessions among multiple processes, so that for example, you can warmup the session upon the server startup, then all the other PHP processes will benefit from the warmed up sessions.<\/p>\n<\/body>","methods":[]}